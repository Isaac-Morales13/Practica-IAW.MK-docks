
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../about/">
      
      
        <link rel="next" href="../practica5_2/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.7">
    
    
      
        <title>Practica 1_1 - IAW</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#practica-iaw11" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="IAW" class="md-header__button md-logo" aria-label="IAW" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            IAW
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Practica 1_1
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="IAW" class="md-nav__button md-logo" aria-label="IAW" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    IAW
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Principal
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Acerca de
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Practica 1_1
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Practica 1_1
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#configuracion-del-archivo-install_lampsh" class="md-nav__link">
    <span class="md-ellipsis">
      Configuración del archivo install_lamp.sh
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuración del archivo install_lamp.sh">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-primeros-pasos" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 Primeros pasos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-instalacion-de-apache" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 Instalación de Apache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-instalacion-de-mysql-server" class="md-nav__link">
    <span class="md-ellipsis">
      1.3 Instalación de MySQL Server
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuracion-del-archivo-install_toolssh" class="md-nav__link">
    <span class="md-ellipsis">
      Configuración del archivo install_tools.sh
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuración del archivo install_tools.sh">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-primeros-pasos" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 Primeros pasos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-instalacion-de-phpmyadmin" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 Instalación de phpMyAdmin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-instalacion-de-adminer" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 Instalación de Adminer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-complementos-mysql" class="md-nav__link">
    <span class="md-ellipsis">
      2.4 Complementos mySQL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#25-instalacion-de-goacces" class="md-nav__link">
    <span class="md-ellipsis">
      2.5 Instalación de GoAcces
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#26-control-de-acceso-a-un-directorio-con-autentificacion-basica" class="md-nav__link">
    <span class="md-ellipsis">
      2.6 Control de acceso a un directorio con autentificación básica
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#27-control-de-acceso-a-un-directorio-con-htaccess" class="md-nav__link">
    <span class="md-ellipsis">
      2.7 Control de acceso a un directorio con htaccess
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../practica5_2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Practica 5_2
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#configuracion-del-archivo-install_lampsh" class="md-nav__link">
    <span class="md-ellipsis">
      Configuración del archivo install_lamp.sh
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuración del archivo install_lamp.sh">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-primeros-pasos" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 Primeros pasos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-instalacion-de-apache" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 Instalación de Apache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-instalacion-de-mysql-server" class="md-nav__link">
    <span class="md-ellipsis">
      1.3 Instalación de MySQL Server
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuracion-del-archivo-install_toolssh" class="md-nav__link">
    <span class="md-ellipsis">
      Configuración del archivo install_tools.sh
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuración del archivo install_tools.sh">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-primeros-pasos" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 Primeros pasos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-instalacion-de-phpmyadmin" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 Instalación de phpMyAdmin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-instalacion-de-adminer" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 Instalación de Adminer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-complementos-mysql" class="md-nav__link">
    <span class="md-ellipsis">
      2.4 Complementos mySQL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#25-instalacion-de-goacces" class="md-nav__link">
    <span class="md-ellipsis">
      2.5 Instalación de GoAcces
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#26-control-de-acceso-a-un-directorio-con-autentificacion-basica" class="md-nav__link">
    <span class="md-ellipsis">
      2.6 Control de acceso a un directorio con autentificación básica
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#27-control-de-acceso-a-un-directorio-con-htaccess" class="md-nav__link">
    <span class="md-ellipsis">
      2.7 Control de acceso a un directorio con htaccess
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="practica-iaw11">Práctica-IAW.1.1</h1>
<p>En esta practica vamos a crear una pila LAMP y todas las herramientas adicionales en una instancia EC2 en Amazon Web Services (AWS) con la última versión de Ubuntu Server.</p>
<blockquote>
<p>[!IMPORTANT]<br />
Antes de empezar a configurar los archivos vamos a crear la siguiente estructura de archivos y directorios(el directorio imagenes no es necesario)</p>
<p><img alt="" src="../imagenes/estructura_general.png" /></p>
</blockquote>
<h2 id="configuracion-del-archivo-install_lampsh">Configuración del archivo <code>install_lamp.sh</code></h2>
<p>Vamos a empezar configurando el archivo <code>install_lamp</code>(script que normalmente se utiliza para automatizar la instalación y configuración de un servidor ). </p>
<h3 id="11-primeros-pasos">1.1 Primeros pasos</h3>
<p>Lo primero que tenemos que hacer es poner lo siguiente:</p>
<pre><code class="language-bash">#!/bin/bash

set -ex

apt update

apt upgrade -y
</code></pre>
<p><code>#!/bin/bash:</code> Indica al sistema que intérprete debe usar para ejecutar el script</p>
<p><code>set -ex:</code> El script se detendra en caso de error y además muestra comando antes de que sea ejecutado,</p>
<p><code>apt update y upgrade:</code> Actualización de repositorios y paquetes. <code>-y</code> se usa para aceptar automaticamente las preguntas que nos pueden hacer en la actualización, lo que automatiza el proceso</p>
<h3 id="12-instalacion-de-apache">1.2 Instalación de Apache</h3>
<p>Ahora vamos a instalar Apache,un servidor web que nos permite alojar sitios aplicaciones en la web</p>
<pre><code class="language-bash">apt install apache2 -y
</code></pre>
<p>Habilitamos el módulo rewrite, que permite reescribir las URLs y configurar reglas de redireccionamiento, para hacerlas  más amigables y mejorar el SEO de los sitios web.</p>
<pre><code class="language-bash">a2enmod rewrite
</code></pre>
<blockquote>
<p>[!IMPORTANT]<br />
Antes de seguir tenemos que tener configurado el archivo <code>000-default.conf</code> de esta forma:
<img alt="" src="../imagenes/estructura-000-default.conf.png" /></p>
<p><code>DirectoryIndex:</code> Configura el orden prioridad de los archivos que se van a mostrar cuando se accede a un directorio</p>
<p><code>ErrorLog:</code> Establece la ubicación del archivo de registro donde se almacenarán los mensajes de error generados por el servidor.</p>
<p><code>Custom Log:</code> Define el archivo de registro de acceso donde se guardarán las solicitudes HTTP que recibe el servidor</p>
</blockquote>
<p>Copiamos el archivo de configuración de Apache en la ruta <code>/etc/apache2/sites-available</code></p>
<pre><code class="language-bash">cp ../conf/000-default.conf /etc/apache2/sites-available
</code></pre>
<p>Instalamos PHP y algunos módulo para Apache y MySQL</p>
<pre><code class="language-bash">apt install php libapache2-mod-php php-mysql -y
</code></pre>
<p>Creamos los directorios para alojar cada uno de los sitios web</p>
<pre><code class="language-bash"> mkdir -p /var/www/html/web1
 mkdir -p /var/www/html/web2
</code></pre>
<p>Creamos los archivos de configuración para cada uno de los sitios web. Empezamos por el sitio web 1.</p>
<pre><code class="language-bash"> nano /etc/apache2/sites-available/web1.conf
</code></pre>
<p>Una vez dentro añadimos esto</p>
<pre><code class="language-bash">&lt;VirtualHost *:80&gt;
    ServerAdmin webmaster@web1.com
    ServerName web1.com
    DocumentRoot /var/www/html/web1
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
&lt;/VirtualHost&gt;
</code></pre>
<p>Hacemos los mismos pasos para la web 2 pero añadimos esto</p>
<pre><code class="language-bash">&lt;VirtualHost *:80&gt;
    ServerAdmin webmaster@web2.com
    ServerName web2.com
    DocumentRoot /var/www/html/web2
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
&lt;/VirtualHost&gt;
</code></pre>
<p>Deshabilitamos el sitio virtual que viene por defecto </p>
<pre><code class="language-bash">sudo a2dissite 000-default.conf 
</code></pre>
<p>Y habilitamos los nuevos que hemos creado</p>
<pre><code class="language-bash">sudo a2ensite web1.conf
sudo a2ensite web2.conf
</code></pre>
<p>Para que se aplique la nueva configuración es necesario ejecutar el comando</p>
<pre><code class="language-bash">sudo systemctl reload apache2
</code></pre>
<p>Editamos el archivo /etc/hosts de nuestro equipo para resolver los nombres de dominio de forma local en nuestro entorno de desarrollo.</p>
<pre><code class="language-bash">34.206.30.8   web1.com    
34.206.30.8  web2.com
</code></pre>
<blockquote>
<p>[!IMPORTANT]
Antes de seguir tenemos que tener configurado el archivo index.php de esta forma:</p>
<p><img alt="" src="../imagenes/estructura-index.php.png" /></p>
</blockquote>
<p>Copiamos el script de prueba de PHP en /var/www/html</p>
<pre><code class="language-bash">cp ../php/index.php /var/www/html
</code></pre>
<p>Modificamos el propietario y el grupo del archivo <code>index.php</code></p>
<pre><code class="language-bash"> chown -R www-data:www-data /var/www/htm
</code></pre>
<p><code>-R:</code>Recursivo.Indica que el cambio de propietario debe aplicarse no solo al directorio especificado, sino también a todos los archivos y subdirectorios dentro de él</p>
<p>Hechas estas configuraciones si ponemos nuestra ip en algun navegador nos deberia salir esto
<img alt="" src="../imagenes/web.ip.png" /></p>
<h3 id="13-instalacion-de-mysql-server">1.3 Instalación de MySQL Server</h3>
<p>Ahora vamos a instalar el sistema gestor de bases de datos MySQL</p>
<pre><code class="language-bash">apt install mysql-server -y
</code></pre>
<p>Una vez instalado podemos acceder a el mediante terminal</p>
<p><img alt="" src="../imagenes/prueba_terminal_MySQL.png" /></p>
<p>Despues de estas configuraciones y añadir algunos de los comandos al script, deberia quedar asi:</p>
<pre><code class="language-bash">#!/bin/bash

# Configuramos para mostrar los comandos y finalizar si hay error
set -ex

# Actualizamos los repositorios
apt update

# Actualiza los paquetes
apt upgrade -y

# Instalamos el servidor web Apache
apt install apache2 -y

# Habilitamos el modulo rewrite
a2enmod rewrite

# Copiamos el archivo de configuración de Apache
cp ../conf/000-default.conf /etc/apache2/sites-available

# Instalamos PHP y algunos módulos de php para Apache y MySQL
apt install php libapache2-mod-php php-mysql -y

# Reiniciamos el servicio de Apache
systemctl restart apache2

# Instalamos MYSQL Server
 apt install mysql-server -y

# Copiamos el script de prueba de PHP en /var/www/html
cp ../php/index.php /var/www/html

# Modificamos el propietario y el grupo del archivo index.php
chown -R www-data:www-data /var/www/html
</code></pre>
<h2 id="configuracion-del-archivo-install_toolssh">Configuración del archivo <code>install_tools.sh</code></h2>
<p>Ahora vamos a configurar el archivo install_tools, que incluye herramientas necesarias para la instalación de la pila LAMP</p>
<h3 id="21-primeros-pasos">2.1 Primeros pasos</h3>
<p>Al igual que en el otro script, aquí tambien tendremos que poner lo siguiente:</p>
<pre><code class="language-bash">#!/bin/bash

set -ex

apt update

apt upgrade -y
</code></pre>
<p>Hecho esto vamos a importar el archivo de variables para tener acceso a estas variables</p>
<pre><code class="language-bash"> source .env
</code></pre>
<blockquote>
<p>[!IMPORTANT]<br />
Estas variables no las tenemos en este script porque estan almacenadas en el archivo .gitignore, cuya función es especificar qué archivos o directorios deben ser ignorados por Git. El archivo .env que es el que almacena las contraseñas esta almacenado ahí  para proteger la intengridad de estos datos importantes</p>
<p><img alt="" src="../imagenes/archivo_.gitignore.png" /></p>
<p>El archivo env deberia contener algo parecido a esto pero con los valores de las variables(en la captura se han eliminado para proteger estos datos)</p>
<p><img alt="" src="../imagenes/archivo_.env.png" /></p>
<p>[!TIP]
Para poder saber las variables que se configura se hace un archivo llamado <code>env.example</code> en que ponemos las variables sin sus valores(este archivo si se guarda en git)
<img alt="" src="../imagenes/archivo_.env.example.png" /></p>
</blockquote>
<h3 id="22-instalacion-de-phpmyadmin">2.2 Instalación de phpMyAdmin</h3>
<p>Automatizamos las respuestas de phpmyadmin cuando se está actualizando, evitando tener que añadirlo manualmente</p>
<pre><code class="language-bash">echo &quot;phpmyadmin phpmyadmin/reconfigure-webserver multiselect apache2&quot; | debconf-set-selections
echo &quot;phpmyadmin phpmyadmin/dbconfig-install boolean true&quot; | debconf-set-selections
echo &quot;phpmyadmin phpmyadmin/mysql/app-pass password $PHPMYADMIN_APP_PASSWORD&quot; | debconf-set-selections
echo &quot;phpmyadmin phpmyadmin/app-password-confirm password $PHPMYADMIN_APP_PASSWORD&quot; | debconf-set-selections
</code></pre>
<p>Configuradas las respuestas pasamos a instalar phpMyAdmin</p>
<pre><code class="language-bash">apt install phpmyadmin php-mbstring php-zip php-gd php-json php-curl -y
</code></pre>
<h3 id="23-instalacion-de-adminer">2.3 Instalación de Adminer</h3>
<p>Ahora pasamos a instalar Adminer,una herramienta de gestión de bases de datos basada en web que permite a los usuarios administrar y manipular bases de datos de forma sencilla y eficiente</p>
<p>Creamos un directorio para Adminer</p>
<pre><code class="language-bash">mkdir -p /var/www/html/adminer
</code></pre>
<p><code>-p:</code>Indica la ruta donde queremos guardar el archivo</p>
<p>Descargamos Adminer</p>
<pre><code class="language-bash">wget https://github.com/vrana/adminer/releases/download/v4.8.1/adminer-4.8.1-mysql.php -P /var/www/html/adminer
</code></pre>
<p>Renombramos el nombre del script de Adminer a uno más sencillo</p>
<pre><code class="language-bash">mv /var/www/html/adminer/adminer-4.8.1-mysql.php /var/www/html/adminer/index.php
</code></pre>
<p>Modificamos el propietario y el grupo del archivo</p>
<pre><code class="language-bash">chown -R www-data:www-data /var/www/html/adminer
</code></pre>
<p>Hecho esto deberia ir si ponemos nuestra ip/adminer en un buscador
<img alt="" src="../imagenes/adminer.png" /></p>
<h3 id="24-complementos-mysql">2.4 Complementos mySQL</h3>
<p>Vamos a crear una base de datos de ejemplo</p>
<pre><code class="language-bash">mysql -u root &lt;&lt;&lt; &quot;DROP DATABASE IF EXISTS $DB_NAME&quot;
mysql -u root &lt;&lt;&lt; &quot;CREATE DATABASE $DB_NAME&quot;
</code></pre>
<p>Y un usuario para esta base de datos</p>
<pre><code class="language-bash">mysql -u root &lt;&lt;&lt; &quot;DROP USER IF EXISTS '$DB_USER'@'%'&quot;
mysql -u root &lt;&lt;&lt; &quot;CREATE USER '$DB_USER'@'%' IDENTIFIED BY '$DB_PASSWORD'&quot;
mysql -u root &lt;&lt;&lt; &quot;GRANT ALL PRIVILEGES ON $DB_NAME.* TO '$DB_USER'@'%'&quot;
</code></pre>
<p>Ahora si nos vamos a nuestra IP/phpmyadmin nos deberia salir algo parecido a esto:
<img alt="" src="../imagenes/phpmyadmin.png" /></p>
<h3 id="25-instalacion-de-goacces">2.5 Instalación de GoAcces</h3>
<p>GoAccess es una herramienta de análisis de logs en tiempo real y de visualización de datos</p>
<p>Primero lo instalamos</p>
<pre><code>apt install goaccess -y
</code></pre>
<p>Luego creamos un directorio para los informes estadisticos</p>
<pre><code class="language-bash">mkdir -p /var/www/html/stats
</code></pre>
<p>Finalmente ejecutamos GoAcces en background</p>
<pre><code>goaccess /var/log/apache2/access.log -o /var/www/html/stats/index.html --log-format=COMBINED --real-time-html --daemonize
</code></pre>
<p><code>real-time-html:</code> Genera un informe que se actualiza en tiempo real</p>
<p><code>daemonize:</code> Hace que se ejecute como un proceso en segundo plano</p>
<h3 id="26-control-de-acceso-a-un-directorio-con-autentificacion-basica">2.6 Control de acceso a un directorio con autentificación básica</h3>
<blockquote>
<p>[!IMPORTANT]<br />
Antes de seguir tenemos que tener configurado el archivo <code>000-default.stats.conf de esta manera</code>:
<img alt="" src="../imagenes/000-default-stats.png" /></p>
</blockquote>
<p>Copiamos el archivo default stats a /etc/apache2/sites-available</p>
<pre><code class="language-bash">cp ../conf/000-default-stats.conf /etc/apache2/sites-available
</code></pre>
<p>Deshabilitamos el virtualhost que hay por defecto</p>
<pre><code class="language-bash">a2dissite 000-default.conf
</code></pre>
<p>Habilitamos el nuevo Virtualhost</p>
<pre><code class="language-bash">a2ensite 000-default-stats.conf
</code></pre>
<p>Hacemos un reload a apache</p>
<pre><code class="language-bash">systemctl reload apache2
</code></pre>
<p>Creamos el archivo de contraseñas</p>
<pre><code class="language-bash">htpasswd -bc /etc/apache2/.htpasswd $STATS_USERNAME $STATS_PASSWORD
</code></pre>
<p><code>-bc:</code> Para poder incluir este comando en un script de bash,de este modo podemos indicarle el nombre del usuario y la contraseña como parámetros</p>
<h3 id="27-control-de-acceso-a-un-directorio-con-htaccess">2.7 Control de acceso a un directorio con htaccess</h3>
<p>Htaccess permite realizar ajustes en la configuración del servidor sin necesidad de modificar el archivo de configuración principal de Apache</p>
<blockquote>
<p>[!IMPORTANT]<br />
Antes de seguir tenemos que tener configurado el archivo <code>000-default-htaccess.conf</code>asi:</p>
<p><img alt="" src="../imagenes/000-default-htaccess.conf.png" /></p>
</blockquote>
<p>Copiamos el archivo default-stats
 ```bash
cp ../conf/000-default-htaccess.conf /etc/apache2/sites-available</p>
<pre><code>
Deshabilitamos el virtualhost 000-default-stats.conf
 ```bash
a2dissite 000-default-stats.conf
</code></pre>
<p>Habilitamos el nuevo virtualhost 000-default-htaccess.conf
 ```bash
a2ensite 000-default-htaccess.conf</p>
<pre><code>Hacemos un reload a apache
 ```bash
systemctl reload apache2
</code></pre>
<blockquote>
<p>[!IMPORTANT]<br />
Antes de seguir tenemos que tener configurado el archivo <code>.htaccess</code> as:</p>
<p><img alt="" src="../imagenes/htaccess.png" /></p>
</blockquote>
<p>Copiamos el archivo .htaccess a /var/www/html/stats para que al entrar a la web nos pida las credenciales 
 ```bash
cp ../conf/.htaccess /var/www/html/stats</p>
<pre><code>
Ahora si nos vamos a nuestra IP/stats nos pedirá que iniciemos sesión con nuestra credenciales
![](imagenes/inicio_sesion.png)

Una vez introducidas las credenciales tendremos acceso al panel de control
![](imagenes/panel_control.png)

Ya tendriamos completo el script que quedaria tal que asi:
 ```bash
#!/bin/bash

# Importamos el archivo de variables
source .env

# Configuramos para mostrar los comandos y finalizar si hay error
set -ex

# Actualizamos los repositorios
apt update

# Actualiza los paquetes
apt upgrade -y

# Configuramos las respuestas para la instalación de phpMyAdmin
echo &quot;phpmyadmin phpmyadmin/reconfigure-webserver multiselect apache2&quot; | debconf-set-selections
echo &quot;phpmyadmin phpmyadmin/dbconfig-install boolean true&quot; | debconf-set-selections
echo &quot;phpmyadmin phpmyadmin/mysql/app-pass password $PHPMYADMIN_APP_PASSWORD&quot; | debconf-set-selections
echo &quot;phpmyadmin phpmyadmin/app-password-confirm password $PHPMYADMIN_APP_PASSWORD&quot; | debconf-set-selections

# Instalamos phpMyAdmin
apt install phpmyadmin php-mbstring php-zip php-gd php-json php-curl -y

#-----------------------------------------------------------------------------------------------------------------------
# Instalamos Adminer

# Paso 1. Creamos un directorio para Adminer
mkdir -p /var/www/html/adminer

# Paso 2. Descargamos Adminer
wget https://github.com/vrana/adminer/releases/download/v4.8.1/adminer-4.8.1-mysql.php -P /var/www/html/adminer

# Paso 3. Renombramos el nombre del script de Adminer
mv /var/www/html/adminer/adminer-4.8.1-mysql.php /var/www/html/adminer/index.php

# Paso 4. Modificamos el propietario y el grupo del archivo 
chown -R www-data:www-data /var/www/html/adminer

#------------------------------------------------------------------------------------------------------------------------------
# Creamos una base de datos de ejemplo
mysql -u root &lt;&lt;&lt; &quot;DROP DATABASE IF EXISTS $DB_NAME&quot;
mysql -u root &lt;&lt;&lt; &quot;CREATE DATABASE $DB_NAME&quot;

# Creamos un usuario para la base de datos de ejemplo
mysql -u root &lt;&lt;&lt; &quot;DROP USER IF EXISTS '$DB_USER'@'%'&quot;
mysql -u root &lt;&lt;&lt; &quot;CREATE USER '$DB_USER'@'%' IDENTIFIED BY '$DB_PASSWORD'&quot;
mysql -u root &lt;&lt;&lt; &quot;GRANT ALL PRIVILEGES ON $DB_NAME.* TO '$DB_USER'@'%'&quot;

#--------------------------------------------------------------------------------------------------------------------------------
#Instalación GoAcces
apt install goaccess -y

# Creamos un directorio para los informes estadisticos
mkdir -p /var/www/html/stats

# Ejecutamos Goaccess en background
goaccess /var/log/apache2/access.log -o /var/www/html/stats/index.html --log-format=COMBINED --real-time-html --daemonize

#------------------------------------------------------------------------------------------------------------------------------
#Control de acceso a un directorio con autentificación básica
# Copiamos el archivo default stats

cp ../conf/000-default-stats.conf /etc/apache2/sites-available

# Deshabilitamos el virtualhost que hay por defecto
a2dissite 000-default.conf

# Habilitamos el nuevo Virtualhost
a2ensite 000-default-stats.conf

#Hacemos la configuración de apache
systemctl reload apache2

# Creamos el archivo de contraseñas
htpasswd -bc /etc/apache2/.htpasswd $STATS_USERNAME $STATS_PASSWORD

#------------------------------------------------------------------------------------------------------------------------------
#Control de acceso a un directorio con .htaccess
# Copiamos el archivo default-stats
cp ../conf/000-default-htaccess.conf /etc/apache2/sites-available

# Deshabilitamos el virtualhost 000-default-stats.conf
a2dissite 000-default-stats.conf

# Habilitamos el nuevo virtualhost 000-default-htaccess.conf
a2ensite 000-default-htaccess.conf

# Recargamos la configuracion de apache
systemctl reload apache2

# Copiamos el archivo .htaccess a /var/www/html/stats
cp ../conf/.htaccess /var/www/html/stats
</code></pre>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>